<% include ./partials/header.ejs %>
    <link rel="stylesheet" href="../stylesheets/userprofile.css">
    <div id="unfollow-overlay">
        <div id="unfollow-box">
            <div id="unfollow-box-top">
                <div id="ub-user-dp">
                    <img src="../images/profilepicuploads/<%= clickedUser.profile %>" alt="">
                </div>
                <h3>
                    <%= clickedUser.username %>
                </h3>
                <svg aria-label="Close" class="x1lliihq x1n2onr6 x5n08af close-btn" fill="currentColor" height="18"
                    role="img" viewBox="0 0 24 24" width="18">
                    <title>Close</title>
                    <polyline fill="none" points="20.643 3.357 12 12 3.353 20.647" stroke="currentColor"
                        stroke-linecap="round" stroke-linejoin="round" stroke-width="3"></polyline>
                    <line fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                        stroke-width="3" x1="20.649" x2="3.354" y1="20.649" y2="3.354"></line>
                </svg>
            </div>
            <div id="unfollow-box-btm">
                <div class="ub-option">
                    <p>Close Friend</p>
                    <div id="cf-icon">
                        <svg aria-label="Close friend" class="x1lliihq x1n2onr6 x1g9anri" fill="currentColor"
                            height="16" role="img" viewBox="0 0 24 24" width="16">
                            <title>Close friend</title>
                            <path
                                d="M18.18 22.51a.99.99 0 0 1-.513-.142L12 18.975l-5.667 3.393a1 1 0 0 1-1.492-1.062l1.37-6.544-4.876-4.347a.999.999 0 0 1 .536-1.737l6.554-.855 2.668-5.755a1 1 0 0 1 1.814 0l2.668 5.755 6.554.855a.999.999 0 0 1 .536 1.737l-4.876 4.347 1.37 6.544a1 1 0 0 1-.978 1.205Z">
                            </path>
                        </svg>
                    </div>
                </div>
                <div class="ub-option">
                    <p>Add to favourites</p>
                    <svg aria-label="Favorited" class="x1lliihq x1n2onr6 x5n08af favourite" fill="currentColor"
                        height="20" role="img" viewBox="0 0 24 24" width="20">
                        <title>Favorited</title>
                        <path
                            d="M18.18 22.51a.99.99 0 0 1-.513-.142L12 18.975l-5.667 3.393a1 1 0 0 1-1.492-1.062l1.37-6.544-4.876-4.347a.999.999 0 0 1 .536-1.737l6.554-.855 2.668-5.755a1 1 0 0 1 1.814 0l2.668 5.755 6.554.855a.999.999 0 0 1 .536 1.737l-4.876 4.347 1.37 6.544a1 1 0 0 1-.978 1.205ZM12 16.81a1 1 0 0 1 .514.142l4.22 2.528-1.021-4.873a.998.998 0 0 1 .313-.952l3.676-3.276-4.932-.644a1 1 0 0 1-.778-.57L12 4.867l-1.992 4.297a1 1 0 0 1-.779.57l-4.931.644 3.676 3.276a.998.998 0 0 1 .313.951l-1.02 4.873 4.22-2.527A1 1 0 0 1 12 16.81Z">
                        </path>
                    </svg>
                </div>
                <div class="ub-option">
                    <p>Mute</p>
                    <svg aria-label="Right chevron" class="x1lliihq x1n2onr6 x1roi4f4 side-arrow" fill="currentColor"
                        height="14" role="img" viewBox="0 0 24 24" width="14">
                        <title>Right chevron</title>
                        <path
                            d="M21 17.502a.997.997 0 0 1-.707-.293L12 8.913l-8.293 8.296a1 1 0 1 1-1.414-1.414l9-9.004a1.03 1.03 0 0 1 1.414 0l9 9.004A1 1 0 0 1 21 17.502Z">
                        </path>
                    </svg>
                </div>
                <div class="ub-option">
                    <p>Restrict</p>
                    <svg aria-label="Right chevron" class="x1lliihq x1n2onr6 x1roi4f4 side-arrow" fill="currentColor"
                        height="14" role="img" viewBox="0 0 24 24" width="14">
                        <title>Right chevron</title>
                        <path
                            d="M21 17.502a.997.997 0 0 1-.707-.293L12 8.913l-8.293 8.296a1 1 0 1 1-1.414-1.414l9-9.004a1.03 1.03 0 0 1 1.414 0l9 9.004A1 1 0 0 1 21 17.502Z">
                        </path>
                    </svg>
                </div>
                <a href="/unfollow/<%= clickedUser.username %>">
                    <div class="ub-option" id="unfollow-btn" onclick="unfollow()">
                        <p>Unfollow</p>
                    </div>
                </a>
            </div>
        </div>
    </div>
    <div id="comments-overlay">
        <div id="comments-box">
            <div id="comments-left">
                <img src="" alt="">
            </div>
            <div id="comments-right">
                <div id="comments-nav">
                    <div id="comments-nav-left">
                        <div id="user-dp">
                            <img src="" alt="">
                        </div>
                        <a href="">username</a>
                    </div>
                    <svg aria-label="More options" class="x1lliihq x1n2onr6 x5n08af" fill="currentColor" height="24"
                        role="img" viewBox="0 0 24 24" width="24">
                        <title>More options</title>
                        <circle cx="12" cy="12" r="1.5"></circle>
                        <circle cx="6" cy="12" r="1.5"></circle>
                        <circle cx="18" cy="12" r="1.5"></circle>
                    </svg>
                </div>
                <div id="comments-section">

                </div>
                <div id="comments-footer">
                    <div id="cf-top">
                        <div id="cf-top-left">
                            <div id="like-btn">

                            </div>
                            <svg aria-label="Comment" class="x1lliihq x1n2onr6 x5n08af" fill="currentColor" height="24"
                                role="img" viewBox="0 0 24 24" width="24">
                                <title>Comment</title>
                                <path d="M20.656 17.008a9.993 9.993 0 1 0-3.59 3.615L22 22Z" fill="none"
                                    stroke="currentColor" stroke-linejoin="round" stroke-width="2"></path>
                            </svg>
                        </div>
                        <svg aria-label="Save" class="x1lliihq x1n2onr6 x5n08af" fill="currentColor" height="24"
                            role="img" viewBox="0 0 24 24" width="24">
                            <title>Save</title>
                            <polygon fill="none" points="20 21 12 13.44 4 21 4 3 20 3 20 21" stroke="currentColor"
                                stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></polygon>
                        </svg>
                    </div>
                    <div id="likes-dets">

                    </div>
                    <form id="comment-form">
                        <textarea name="" placeholder="Add a comment..."></textarea>
                    </form>
                </div>
            </div>
        </div>
        <svg aria-label="Close" class="x1lliihq x1n2onr6 x9bdzbf close-post-btn" fill="currentColor" height="18"
            role="img" viewBox="0 0 24 24" width="18">
            <title>Close</title>
            <polyline fill="none" points="20.643 3.357 12 12 3.353 20.647" stroke="currentColor" stroke-linecap="round"
                stroke-linejoin="round" stroke-width="3"></polyline>
            <line fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="3"
                x1="20.649" x2="3.354" y1="20.649" y2="3.354"></line>
        </svg>
    </div>
    <% if(clickedUser.accountType === 'public' || loggedInUser.following.indexOf(clickedUser._id) !== -1){ %>
        <div id="following-overlay">
            <div id="following-users">
                <div id="following-users-nav">
                    <span></span>
                    <h4>Following</h4>
                    <div id="close-users-btn" onclick="closeUsers()">
                        <svg aria-label="Close" class="x1lliihq x1n2onr6 x9bdzbf close-post-btn" fill="currentColor"
                            height="18" role="img" viewBox="0 0 24 24" width="18">
                            <title>Close</title>
                            <polyline fill="none" points="20.643 3.357 12 12 3.353 20.647" stroke="currentColor"
                                stroke-linecap="round" stroke-linejoin="round" stroke-width="3"></polyline>
                            <line fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                                stroke-width="3" x1="20.649" x2="3.354" y1="20.649" y2="3.354"></line>
                        </svg>
                    </div>
                </div>
                <div class="following-allusers">
                    <% clickedUser.following.forEach((user)=> { %>
                        <div class="following-user">
                            <div class="following-user-left">
                                <div class="following-user-dp">
                                    <img src="../images/profilepicuploads/<%= user.profile %>" alt="">
                                </div>
                                <div class="following-user-name">
                                    <a href="/profile/<%= user.username %>">
                                        <%= user.username %>
                                    </a>
                                    <p>
                                        <%= user.fullname %>
                                    </p>
                                </div>
                            </div>
                            <button class="following-btn">Following</button>
                        </div>
                        <% }) %>
                </div>
            </div>
        </div>
        <div id="follower-overlay">
            <div id="following-users">
                <div id="following-users-nav">
                    <span></span>
                    <h4>Followers</h4>
                    <div id="close-users-btn" onclick="closeUsers()">
                        <svg aria-label="Close" class="x1lliihq x1n2onr6 x9bdzbf close-post-btn" fill="currentColor"
                            height="18" role="img" viewBox="0 0 24 24" width="18">
                            <title>Close</title>
                            <polyline fill="none" points="20.643 3.357 12 12 3.353 20.647" stroke="currentColor"
                                stroke-linecap="round" stroke-linejoin="round" stroke-width="3"></polyline>
                            <line fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                                stroke-width="3" x1="20.649" x2="3.354" y1="20.649" y2="3.354"></line>
                        </svg>
                    </div>
                </div>
                <div class="following-allusers">
                    <% clickedUser.followers.forEach((user)=> { %>
                        <div class="following-user">
                            <div class="following-user-left">
                                <div class="following-user-dp">
                                    <img src="../images/profilepicuploads/<%= user.profile %>" alt="">
                                </div>
                                <div class="following-user-name">
                                    <a href="/profile/username">
                                        <%= user.username %>
                                    </a>
                                    <p>
                                        <%= user.fullname %>
                                    </p>
                                </div>
                            </div>
                            <% if(clickedUser.following.indexOf(user._id)===-1){ %>
                                <button class="follow-btn">Follow</button>
                                <% } else{ %>
                                    <button class="follow-btn">Following</button>
                                    <% } %>
                        </div>
                        <% }) %>
                </div>
            </div>
        </div>
    <% } %>
    <div id="right">
        <div id="right-top" class="right-top-person-profile">
            <div id="user-dp">
                <img src="../images/profilepicuploads/<%= clickedUser.profile %>" alt="">
            </div>
            <div id="right-top-right">
                <div id="right-top-r1">
                    <%= clickedUser.username %>
                    <% if(clickedUser.accountType === "private"){ %>
                        <% if(clickedUser.requests.indexOf(loggedInUser._id)===-1){ %>
                            <% if(loggedInUser.following.indexOf(clickedUser._id)===-1){ %>
                                <a href="/follow/<%= clickedUser.username %>" id="follow-btn"
                                    class="person-profile-btn">Follow</a>
                                <% }else{ %>
                                    <button id="following-btn" class="person-profile-btn"
                                        style="background-color: rgb(54, 54, 54);" onclick="showUnfollow()">Following
                                        <svg aria-label="Right chevron" class="x1lliihq x1n2onr6 x1roi4f4 down-arrow"
                                            fill="currentColor" height="14" role="img" viewBox="0 0 24 24" width="14">
                                            <title>Right chevron</title>
                                            <path
                                                d="M21 17.502a.997.997 0 0 1-.707-.293L12 8.913l-8.293 8.296a1 1 0 1 1-1.414-1.414l9-9.004a1.03 1.03 0 0 1 1.414 0l9 9.004A1 1 0 0 1 21 17.502Z">
                                            </path>
                                        </svg></button>
                                <% } %>
                            <% }else{ %>
                                            <a href="/follow/<%= clickedUser.username %>" id="follow-btn"
                                                class="person-profile-btn"
                                                style="background-color: rgb(54, 54, 54);">Requested</a>
                            <% } %>
                    <% }else{ %>
                        <% if(loggedInUser.following.indexOf(clickedUser._id)===-1){ %>
                            <a href="/directfollow/<%= clickedUser._id %>" id="follow-btn"
                                class="person-profile-btn">Follow</a>
                        <% } else{ %>
                            <button id="following-btn" class="person-profile-btn"
                                        style="background-color: rgb(54, 54, 54);" onclick="showUnfollow()">Following
                                        <svg aria-label="Right chevron" class="x1lliihq x1n2onr6 x1roi4f4 down-arrow"
                                            fill="currentColor" height="14" role="img" viewBox="0 0 24 24" width="14">
                                            <title>Right chevron</title>
                                            <path
                                                d="M21 17.502a.997.997 0 0 1-.707-.293L12 8.913l-8.293 8.296a1 1 0 1 1-1.414-1.414l9-9.004a1.03 1.03 0 0 1 1.414 0l9 9.004A1 1 0 0 1 21 17.502Z">
                                            </path>
                                        </svg></button>
                        <% } %>
                    <% } %>
                        
                                                <a href="" class="person-profile-btn"><svg aria-label="Similar accounts"
                                                        class="x1lliihq x1n2onr6 x5n08af" fill="currentColor"
                                                        height="16" role="img" viewBox="0 0 24 24" width="16">
                                                        <title>Similar accounts</title>
                                                        <path
                                                            d="M19.006 8.252a3.5 3.5 0 1 1-3.499-3.5 3.5 3.5 0 0 1 3.5 3.5Z"
                                                            fill="none" stroke="currentColor" stroke-miterlimit="10"
                                                            stroke-width="2"></path>
                                                        <path
                                                            d="M22 19.5v-.447a4.05 4.05 0 0 0-4.05-4.049h-4.906a4.05 4.05 0 0 0-4.049 4.049v.447"
                                                            fill="none" stroke="currentColor" stroke-linecap="round"
                                                            stroke-linejoin="round" stroke-width="2"></path>
                                                        <line fill="none" stroke="currentColor" stroke-linecap="round"
                                                            stroke-miterlimit="10" stroke-width="2" x1="5.001"
                                                            x2="5.001" y1="7.998" y2="14.003"></line>
                                                        <line fill="none" stroke="currentColor" stroke-linecap="round"
                                                            stroke-miterlimit="10" stroke-width="2" x1="8.004"
                                                            x2="2.003" y1="11" y2="11"></line>
                                                    </svg></a>
                                                <svg aria-label="Options" class="x1lliihq x1n2onr6 x5n08af"
                                                    fill="currentColor" height="32" role="img" viewBox="0 0 24 24"
                                                    width="32">
                                                    <title>Options</title>
                                                    <circle cx="12" cy="12" r="1.5"></circle>
                                                    <circle cx="6" cy="12" r="1.5"></circle>
                                                    <circle cx="18" cy="12" r="1.5"></circle>
                                                </svg>
                </div>
                <div id="right-top-r2">
                    <h3><span>
                            <%= clickedUser.posts.length %>
                        </span> posts</h3>
                    <a href=""><span>
                            <%= clickedUser.followers.length %>
                        </span> followers</a>
                    <a href=""><span>
                            <%= clickedUser.following.length %>
                        </span> following</a>
                </div>
                <h3><span>
                        <%= clickedUser.fullname %>
                    </span></h3>
                <h3>
                    <%= clickedUser.bio %>
                </h3>
                <div id="right-top-r3"></div>
            </div>
        </div>
        <% if(clickedUser.accountType === "public" || loggedInUser.following.indexOf(clickedUser._id) !== -1){ %>
            <div id="right-btm">
                <div id="right-btm-nav">
                    <div class="nav-box">
                        <svg aria-label="" class="x1lliihq x1n2onr6 x5n08af" fill="currentColor" height="12" role="img"
                            viewBox="0 0 24 24" width="12">
                            <title></title>
                            <rect fill="none" height="18" stroke="currentColor" stroke-linecap="round"
                                stroke-linejoin="round" stroke-width="2" width="18" x="3" y="3"></rect>
                            <line fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                                stroke-width="2" x1="9.015" x2="9.015" y1="3" y2="21"></line>
                            <line fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                                stroke-width="2" x1="14.985" x2="14.985" y1="3" y2="21"></line>
                            <line fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                                stroke-width="2" x1="21" x2="3" y1="9.015" y2="9.015"></line>
                            <line fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                                stroke-width="2" x1="21" x2="3" y1="14.985" y2="14.985"></line>
                        </svg>
                        <p>Posts</p>
                    </div>
                    <div class="nav-box nav-box-light">
                        <svg aria-label="" class="x1lliihq x1n2onr6 x5n08af" fill="currentColor" height="12" role="img"
                            viewBox="0 0 24 24" width="12">
                            <title></title>
                            <polygon fill="none" points="20 21 12 13.44 4 21 4 3 20 3 20 21" stroke="currentColor"
                                stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></polygon>
                        </svg>
                        <p>saved</p>
                    </div>
                    <div class="nav-box nav-box-light">
                        <svg aria-label="" class="x1lliihq x1n2onr6 x1roi4f4" fill="currentColor" height="12" role="img"
                            viewBox="0 0 24 24" width="12">
                            <title></title>
                            <path
                                d="M10.201 3.797 12 1.997l1.799 1.8a1.59 1.59 0 0 0 1.124.465h5.259A1.818 1.818 0 0 1 22 6.08v14.104a1.818 1.818 0 0 1-1.818 1.818H3.818A1.818 1.818 0 0 1 2 20.184V6.08a1.818 1.818 0 0 1 1.818-1.818h5.26a1.59 1.59 0 0 0 1.123-.465Z"
                                fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                                stroke-width="2"></path>
                            <path
                                d="M18.598 22.002V21.4a3.949 3.949 0 0 0-3.948-3.949H9.495A3.949 3.949 0 0 0 5.546 21.4v.603"
                                fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                                stroke-width="2"></path>
                            <circle cx="12.072" cy="11.075" fill="none" r="3.556" stroke="currentColor"
                                stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></circle>
                        </svg>
                        <p>tagged</p>
                    </div>
                </div>
                <div id="posts-grid">
                    <% clickedUser.posts.reverse().forEach((post)=> { %>
                        <div class="user-post" onclick="showPost('<%= post._id %>')">
                            <% if(post.image.slice(post.image.lastIndexOf('.') + 1)==='jpg' ||
                                post.image.slice(post.image.lastIndexOf('.') + 1)==='jpeg' ||
                                post.image.slice(post.image.lastIndexOf('.') + 1)==='png' ){ %>
                                <img src="../images/postuploads/<%= post.image %>" alt="">
                                <% }else{ %>
                                    <video src="../images/postuploads/<%= post.image %>" muted></video>
                                    <% } %>
                                        <div class="user-post-dets">
                                            <p><i class="ri-heart-fill"></i> <span>
                                                    <%= post.likes.length %>
                                                </span></p>
                                            <p><i class="ri-chat-3-fill"></i> <span>
                                                    <%= post.comments.length %>
                                                </span></p>
                                        </div>
                        </div>
                        <% }) %>
                </div>
            </div>
        <% } else{ %>
            <div id="right-btm">
                <div id="pvt-account-box">
                    <p>This account is private.</p>
                    <p>Follow to see their photos and <br>videos.</p>
                </div>
            </div>
        <% } %>
        
        <!-- <div id="footer">
            <div id="footer-links">
                <a href="">Meta</a>
                <a href="">About</a>
                <a href="">Blog</a>
                <a href="">Jobs</a>
                <a href="">Help</a>
                <a href="">API</a>
                <a href="">Privacy</a>
                <a href="">Terms</a>
                <a href="">Locations</a>
                <a href="">Instagram Lite</a>
                <a href="">Threads</a>
                <a href="">Contact Uploading & Non-Users</a>
                <a href="">Meta Verified</a>
            </div>
            <div id="footer-bottom">
                <select name="" id="">
                    <option value="">English</option>
                    <option value="">hindi</option>
                </select>
                <p>&copy; 2023 Instagram from Meta</p>
            </div>
        </div> -->
    </div>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
    <script src="../javascripts/userprofile.js"></script>

    <script>
        // var flag = true;

        // function sendreq(){
        //     var followBtn = document.querySelector("#follow-btn")
        //     if(flag){
        //         followBtn.textContent = "Requested"
        //         followBtn.style.backgroundColor = "rgb(54, 54, 54)"
        //         flag = false
        //     } else{
        //         followBtn.textContent = "Follow"
        //         followBtn.style.backgroundColor = "rgb(0, 149, 246)"
        //         flag = true
        //     }

        //     axios.get("/follow/<%= clickedUser.username %>")
        // }

        // function removereq(){
        //     var followBtn = document.querySelector("#follow-btn")
        //     if(flag){
        //         followBtn.textContent = "Follow"
        //         followBtn.style.backgroundColor = "rgb(0, 149, 246)"
        //         flag = false
        //     } else{
        //         followBtn.textContent = "Requested"
        //         followBtn.style.backgroundColor = "rgb(54, 54, 54)"
        //         flag = true
        //     }

        //     axios.get("/follow/<%= clickedUser.username %>")
        // }


        function showUnfollow() {
            document.querySelector("#unfollow-overlay").style.display = "initial"
            document.querySelector(".close-btn").addEventListener("click", () => {
                document.querySelector("#unfollow-overlay").style.display = "none"
            })
        }

        function showFollowers() {
            document.querySelector("#follower-overlay").style.display = "flex"
        }
        function showFollowing() {
            document.querySelector("#following-overlay").style.display = "flex"
        }

        function closeUsers() {
            document.querySelector("#follower-overlay").style.display = "none"
            document.querySelector("#following-overlay").style.display = "none"
        }

    </script>

    <% include ./partials/footer.ejs %>